{% extends "layouts/base.html" %}

{% block title %} Ingreso ticket {% endblock title %}

{% load static %}
{% load humanize %}

{% block stylesheets %}
    <style>

    </style>
{% endblock %}

{% block content %}

    <div class="container-fluid">
        <div class="row">
            <div class="offset-2 col-sm-8">
                <div class="card">
                    <div class="card-header card-header-primary card-header-icon">
                        <div class="card-icon">
                            <i class="material-icons">sms_failed</i>
                        </div>
                        <h4 class="card-title">Ingreso ticket</h4>
                        <div class="row">
                            <div class="col-12 text-right">
                                <button type="button" class="btn btn-outline-info" id="btnRegresar" onclick="goBack();">
                                    <span class="material-icons">arrow_back</span>
                                    Regresar
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <form method="POST" name="frm_ticket" id="frm_ticket" enctype="multipart/form-data">
                            {% csrf_token %}

                            <div class="row" style="margin-top: 15px;">
                                <div class="col-12 text-center">
                                    <h3 class="text-primary">{{ plantilla.categoria }}</h3>
                                    <input type="hidden" name="plantilla_id" value="{{ plantilla.id }}">
                                </div>
                            </div>
                            <div class="row" style="margin-top: 15px;">
                                <div class="col-12">
                                    <b>{{ plantilla.titulo }}</b>
                                    <p>{{ plantilla.descripcion }}</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 col-12" style="margin-top: 35px;">
                                    <div class="form-group">
                                        <label for="titulo" class="bmd-label-floating">Titulo *</label>
                                        <input type="text" class="form-control" name="titulo" id="titulo" value="">
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-top: 35px;">
                                <div class="col-12">
                                    <div class="form-group">
                                        <label for="descripcion" class="bmd-label-floating">Descripción problema (Que esta pasando)</label>
                                        <textarea class="form-control" name="descripcion" id="descripcion" style="height: auto;" rows="5"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-top: 35px;">
                                <div class="col-12">
                                    <div class="form-group">
                                        <label for="causa" class="bmd-label-floating">Causa</label>
                                        <textarea class="form-control" name="causa" id="causa" style="height: auto;" rows="5"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-top: 35px;">
                                <div class="col-12">
                                    <div class="form-group">
                                        <label for="posible_solucion" class="bmd-label-floating">Sugerencia de solución</label>
                                        <textarea class="form-control" name="posible_solucion" id="posible_solucion" style="height: auto;" rows="5"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-top: 35px;">
                                <div class="col-12">
                                    <div class="form-group">
                                        <button type="button" class="btn btn-outline-secondary" id="btnAdjunto" onclick="clickAdjunto();">
                                            <span class="material-icons">file_upload</span>
                                            Adjunto
                                        </button>
                                        <input type="file" class="hidden" name="adjuntos[]" id="adjuntos" multiple onchange="fileUpload();">
                                        <br><br>
                                        <span id="spanFiles"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-top: 35px;">
                                <div class="col-12 text-center">
                                    <div class="form-group">
                                        <button type="button" class="btn btn-outline-success" id="btnSave" onclick="sendForm();">
                                            <span class="material-icons">save</span>
                                            Grabar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock content %}

{% block javascripts %}

    <script>
        const objFileAdjunto = document.getElementById('adjuntos'),
            objSpanAdjuntos = document.getElementById('spanFiles'),
            //objProgressBar = document.getElementById('progress_bar'),
            strUrlBack = "{% url 'tickets-ingreso_ticket' %}";

        const sendForm = () => {

            const objTitulo = document.getElementById('titulo');
            const strTitulo = objTitulo.value.trim();
            if (strTitulo === "") {
                objTitulo.style.setProperty("border", "solid red 1px");
                alert_nova.showNotification("Ingrese el campo requerido", "warning", "danger");
                return false;
            }
            objTitulo.style.removeProperty("border");

            dialogConfirm(submitForm);
        };

        const submitForm = () => {
            simple_submit('frm_ticket');
        };

        const goBack = () => {
            window.location.href = strUrlBack;
        };

        const clickAdjunto = () => {
            objFileAdjunto.click();
        };

        const fileUpload = () => {

            objSpanAdjuntos.innerHTML = ``;
            let intLenght = 0;
            for (let i = 1; i <= objFileAdjunto.files.length; i++) {
                objSpanAdjuntos.innerHTML += `${objFileAdjunto.files[intLenght].name} <br>`;
                intLenght++;
            }

        };

    </script>

{% endblock javascripts %}
